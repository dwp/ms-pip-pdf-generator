{
  "$schema": "https://json-schema.org/draft/2019-09/schema",
  "$id": "https://gitlab.com/dwp/health/pip-apply/schemas/registration/address.schema.1.0.0.json",
  "title": "address schema",
  "description": "Flattened address schema supporting structured address or no fixed abode",
  "type": "object",
  "properties": {
    "line1": {
      "type": "string",
      "minLength": 3,
      "maxLength": 35,
      "examples": ["The House"]
    },
    "line2": {
      "type": "string",
      "minLength": 3,
      "maxLength": 35,
      "examples": ["Anystreet"]
    },
    "line3": {
      "type": "string",
      "minLength": 3,
      "maxLength": 35,
      "examples": ["Anydistrict"]
    },
    "town": {
      "type": "string",
      "minLength": 3,
      "maxLength": 35,
      "examples": ["Anytown"]
    },
    "county": {
      "type": "string",
      "minLength": 3,
      "maxLength": 35,
      "examples": ["Anyshire"]
    },
    "country": {
      "$ref": "country.schema.1.0.0.json",
      "examples": ["Wales"]
    },
    "postcode": {
      "type": "string",
      "pattern": "^(?![QVX])[A-Z]((?![IJZ])[A-Z][0-9](([0-9]?)|([ABEHMNPRVWXY]?))|([0-9]([0-9]?|[ABCDEFGHJKPSTUW]?))) ?[0-9]((?![CIKMOV])[A-Z]){2}$|^(BFPO)[ ]?[0-9]{1,4}$",
      "maxLength": 10,
      "examples": ["AB1 1AB"]
    },
    "noFixedAbode": {
      "description": "True if the person has no fixed address",
      "type": "boolean"
    }
  },
  "allOf": [
    {
      "if": {
        "properties": { "noFixedAbode": { "const": true } },
        "required": ["noFixedAbode"]
      },
      "then": {
        "not": {
          "required": ["line1", "town", "postcode", "country"]
        }
      },
      "else": {
        "required": ["line1", "town", "postcode", "country"]
      }
    }
  ]
}
